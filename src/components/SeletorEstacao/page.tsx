'use client';

import { useState } from 'react';
import linhasData from '@/data/siglas_rota.json';

interface Estacao {
  nome: string;
  sigla: string;
}

interface SeletorDeEstacaoProps {
  onSelecionar: (sigla: string) => void;
  titulo?: string;
  siglaBloqueada?: string;
}

const SeletorDeEstacao = ({ onSelecionar, titulo , siglaBloqueada}: SeletorDeEstacaoProps) => {
  const [linhaSelecionada, setLinhaSelecionada] = useState<string>('');
  const [estacoes, setEstacoes] = useState<Estacao[]>([]);
  const [estacaoSelecionada, setEstacaoSelecionada] = useState<string>('');

  const handleLinhaChange = (e: React.ChangeEvent<HTMLSelectElement>) => {
    const linha = e.target.value;
    setLinhaSelecionada(linha);
    setEstacoes(linhasData[linha as keyof typeof linhasData] || []);
    setEstacaoSelecionada('');
    onSelecionar('');
  };

  const handleEstacaoChange = (e: React.ChangeEvent<HTMLSelectElement>) => {
    const sigla = e.target.value;
    setEstacaoSelecionada(sigla);
    onSelecionar(sigla); 
  };

  return (
    <div className="flex flex-col pt-[3vh] gap-[2.8vh] mb-[14.5vh] max-w-md mx-auto">
      {titulo && <h2 className="text-lg font-bold">{titulo}</h2>}

      <div className='flex flex-row items-center rounded-[15px] border-[3px] border-white px-[1vh] py-[0.5vh]'>
        <div className='w-[20%] justify-center flex'>
            <svg width="5vh" height="3.8vh" viewBox="0 0 36 26" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M30.8571 15.6C30.018 15.5986 29.1917 15.8086 28.4529 16.211L21.0214 8.021C21.563 7.18173 21.8532 6.20211 21.8571 5.2C21.8571 3.82087 21.3153 2.49823 20.3508 1.52304C19.3864 0.547855 18.0783 0 16.7143 0C15.3503 0 14.0422 0.547855 13.0777 1.52304C12.1133 2.49823 11.5714 3.82087 11.5714 5.2C11.5696 5.91265 11.7186 6.61745 12.0086 7.267L8.28 10.192C7.38517 9.48225 6.28016 9.09761 5.14286 9.1C4.1257 9.1 3.13138 9.40497 2.28564 9.97636C1.4399 10.5477 0.78073 11.3599 0.391479 12.31C0.0022283 13.2602 -0.0996174 14.3058 0.0988209 15.3145C0.297259 16.3232 0.787069 17.2497 1.50631 17.977C2.22555 18.7042 3.14192 19.1994 4.13954 19.4001C5.13715 19.6007 6.17121 19.4977 7.11094 19.1042C8.05068 18.7106 8.85388 18.0441 9.41899 17.189C9.98409 16.3338 10.2857 15.3285 10.2857 14.3C10.2838 13.5933 10.1394 12.8944 9.86143 12.246L13.5771 9.321C14.3606 9.93046 15.3011 10.2987 16.2861 10.3817C17.2712 10.4647 18.259 10.2589 19.1314 9.789L26.55 17.979C26.0084 18.8183 25.7182 19.7979 25.7143 20.8C25.7143 21.8285 26.0159 22.8338 26.581 23.689C27.1461 24.5441 27.9493 25.2106 28.8891 25.6042C29.8288 25.9977 30.8628 26.1007 31.8605 25.9001C32.8581 25.6994 33.7744 25.2042 34.4937 24.477C35.2129 23.7497 35.7027 22.8232 35.9012 21.8145C36.0996 20.8058 35.9978 19.7602 35.6085 18.81C35.2193 17.8599 34.5601 17.0477 33.7144 16.4764C32.8686 15.905 31.8743 15.6 30.8571 15.6ZM7.71429 14.3C7.71429 14.8142 7.56348 15.3169 7.28092 15.7445C6.99837 16.172 6.59677 16.5053 6.1269 16.7021C5.65704 16.8989 5.14001 16.9504 4.6412 16.85C4.14239 16.7497 3.6842 16.5021 3.32458 16.1385C2.96496 15.7749 2.72006 15.3116 2.62084 14.8072C2.52162 14.3029 2.57254 13.7801 2.76717 13.305C2.96179 12.8299 3.29138 12.4239 3.71425 12.1382C4.13712 11.8525 4.63428 11.7 5.14286 11.7C5.47404 11.6982 5.80211 11.7646 6.10714 11.895C6.53082 12.063 6.90283 12.3416 7.18519 12.7024C7.46754 13.0633 7.65012 13.4935 7.71429 13.949C7.72067 14.0659 7.72067 14.1831 7.71429 14.3ZM17.2671 7.8C17.0834 7.82009 16.898 7.82009 16.7143 7.8C16.3873 7.80182 16.0634 7.73544 15.7629 7.605C15.3368 7.43891 14.9621 7.16109 14.6774 6.8001C14.3927 6.43911 14.2082 6.00797 14.1429 5.551C14.1365 5.43409 14.1365 5.31691 14.1429 5.2C14.1429 4.51044 14.4138 3.84912 14.896 3.36152C15.3782 2.87393 16.0323 2.6 16.7143 2.6C17.3963 2.6 18.0503 2.87393 18.5326 3.36152C19.0148 3.84912 19.2857 4.51044 19.2857 5.2C19.288 5.46028 19.2489 5.71925 19.17 5.967C19.0452 6.41733 18.8026 6.82528 18.4677 7.14787C18.1328 7.47046 17.718 7.69575 17.2671 7.8ZM30.8571 23.4C30.1752 23.4 29.5211 23.1261 29.0389 22.6385C28.5566 22.1509 28.2857 21.4896 28.2857 20.8C28.2834 20.5397 28.3225 20.2808 28.4014 20.033C28.5418 19.5732 28.8056 19.1619 29.1635 18.8447C29.5214 18.5276 29.9593 18.317 30.4285 18.2366C30.8977 18.1561 31.3797 18.2089 31.821 18.3891C32.2623 18.5692 32.6455 18.8696 32.928 19.2569C33.2104 19.6441 33.381 20.103 33.4208 20.5825C33.4606 21.062 33.3681 21.5433 33.1534 21.9727C32.9388 22.4022 32.6105 22.763 32.2051 23.015C31.7997 23.2669 31.333 23.4002 30.8571 23.4Z" fill="white"/>
            </svg>
        </div>
        <select
            onChange={handleLinhaChange}
            value={linhaSelecionada}
            className={`py-3 px-2 w-[80%] font-xxgeom text-[2.5vh] focus:outline-none ${
                linhaSelecionada === ""
                ? 'text-white/40' 
                : 'text-white/100'
            }`}
            >
            <option value="" disabled>
                Selecione uma linha
            </option>
            {Object.keys(linhasData).map((linha) => (
                <option key={linha} value={linha} className='bg-white text-black'>
                {linha}
                </option>
            ))}
        </select>

      </div>
      
        
        <div className='flex flex-row items-center rounded-[15px] border-[3px] border-white px-2 py-1'>
            <div className='w-[20%] justify-center flex'>
                <svg width="4.8vh" height="4.8vh" viewBox="0 0 38 38" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_2240_69)">
                    <path d="M37.2637 9.45324C36.5178 5.2302 32.7698 1.48215 28.5468 0.73625C28.5423 0.735508 28.5371 0.734766 28.5327 0.734023C25.5869 0.24418 22.469 0.00371094 18.9985 0C15.5295 0.00371094 12.4116 0.24418 9.46734 0.734023C9.46289 0.734766 9.4577 0.735508 9.45324 0.73625C5.22945 1.48289 1.48215 5.2302 0.73625 9.45324C0.735508 9.4577 0.734766 9.46289 0.734023 9.46734C0.24418 12.4123 0.00371094 15.5295 0 19.0015C0.00371094 22.472 0.24418 25.5899 0.734023 28.5327C0.734023 28.5371 0.735508 28.5416 0.73625 28.5468C1.48215 32.7698 5.22945 36.5171 9.45324 37.2637C9.4577 37.2645 9.46289 37.2652 9.46734 37.266C12.4131 37.7558 15.531 37.9963 19.0015 38C22.469 37.9963 25.5869 37.7558 28.5327 37.266C28.5371 37.2652 28.5423 37.2645 28.5468 37.2637C32.7698 36.5178 36.5171 32.7698 37.2637 28.5468C37.2645 28.5423 37.2652 28.5371 37.266 28.5327C37.7558 25.5884 37.9955 22.4705 38 18.9978C37.9963 15.5295 37.7558 12.4116 37.266 9.4666C37.266 9.46215 37.2645 9.45695 37.2637 9.4525V9.45324ZM34.485 28.0629C33.941 31.1221 31.1221 33.9417 28.0621 34.485C25.2722 34.9481 22.3072 35.1752 19.0015 35.1789C15.6921 35.1752 12.727 34.9481 9.93715 34.485C6.87785 33.941 4.05902 31.1221 3.515 28.0636C3.05188 25.2759 2.82402 22.3102 2.82031 19.0015C2.82402 15.6913 3.05113 12.7263 3.515 9.93715C4.05902 6.87785 6.87785 4.05902 9.93715 3.515C12.7263 3.05113 15.6913 2.82402 18.9985 2.82031C22.3072 2.82402 25.273 3.05113 28.0629 3.51426C31.1221 4.05828 33.941 6.87711 34.485 9.93641C34.9481 12.7263 35.1752 15.6913 35.1797 18.997C35.176 22.3079 34.9489 25.273 34.485 28.0614V28.0629Z" fill="white"/>
                    <path d="M25.5129 23.8367C26.1566 23.0515 26.0418 21.8931 25.2565 21.2495C24.4713 20.6059 23.3129 20.7207 22.6693 21.5059C22.0257 22.2912 22.1405 23.4495 22.9257 24.0931C23.711 24.7368 24.8693 24.622 25.5129 23.8367Z" fill="white"/>
                    <path d="M14.1677 24.4907C15.1726 24.346 15.87 23.4141 15.7254 22.4091C15.5808 21.4042 14.6488 20.7068 13.6439 20.8514C12.6389 20.996 11.9415 21.928 12.0861 22.9329C12.2307 23.9379 13.1627 24.6353 14.1677 24.4907Z" fill="white"/>
                    <path d="M24.378 11.1209H13.6222C13.0166 11.1209 12.4369 11.3658 12.0302 11.794C11.6465 12.1978 11.4505 12.721 11.4787 13.2658C11.5196 14.048 11.6019 14.7732 11.7318 15.4842C11.7318 15.4879 11.7333 15.4916 11.7341 15.4953C12.0532 17.1393 13.6259 18.5932 15.3923 18.8775C15.3953 18.8775 15.3982 18.8782 15.4019 18.8789C16.5152 19.0474 17.6923 19.1305 19.0016 19.132C20.3093 19.1305 21.4857 19.0482 22.5989 18.8789C22.6019 18.8789 22.6049 18.8782 22.6086 18.8775C24.375 18.5932 25.9477 17.1385 26.2668 15.4946C26.2668 15.4909 26.2683 15.4871 26.2691 15.4834C26.3989 14.7732 26.4813 14.0473 26.5221 13.265C26.5503 12.7203 26.3544 12.197 25.9707 11.7933C25.5647 11.3658 24.9843 11.1201 24.3787 11.1201L24.378 11.1209ZM24.2243 15.1042C24.0685 15.8916 23.1808 16.6776 22.282 16.8246C21.2734 16.9775 20.2002 17.0517 19.0008 17.0532C17.8007 17.0517 16.7268 16.9775 15.7181 16.8246C14.8037 16.6754 13.9339 15.905 13.7751 15.1042C13.6652 14.5 13.594 13.8803 13.5569 13.2116C13.571 13.2049 13.5925 13.199 13.6214 13.199H24.3772C24.4062 13.199 24.4277 13.2049 24.4418 13.2116C24.4054 13.8811 24.3334 14.5008 24.2236 15.1042H24.2243Z" fill="white"/>
                    <path d="M30.2212 12.2401C29.7566 9.66025 27.4284 7.37209 24.8055 6.91787C24.8018 6.91787 24.7988 6.91639 24.7951 6.91639C23.0079 6.62471 21.1175 6.48221 19.0134 6.47998C16.9108 6.48221 15.0205 6.62471 13.234 6.91639C13.2303 6.91639 13.2273 6.91787 13.2236 6.91787C10.6007 7.37283 8.27324 9.661 7.80789 12.2401C7.80789 12.2438 7.80641 12.2468 7.80641 12.2505C7.50879 14.0058 7.36258 15.8627 7.36035 17.9304C7.36258 19.9974 7.50879 21.8544 7.80641 23.6082C7.80641 23.6119 7.80789 23.6149 7.80789 23.6186C8.09957 25.2395 9.1275 26.7447 10.502 27.7533L8.9798 29.971C8.53895 30.6129 8.70223 31.491 9.34496 31.9318C9.58914 32.0996 9.86672 32.1797 10.1421 32.1797C10.5911 32.1797 11.0327 31.966 11.3058 31.5674L13.122 28.9215C13.1561 28.9282 13.1895 28.9356 13.2236 28.9415C13.2266 28.9415 13.2303 28.943 13.234 28.943C15.0205 29.2347 16.9116 29.3772 19.0157 29.3794C21.1175 29.3772 23.0079 29.234 24.7951 28.943C24.7988 28.943 24.8018 28.9415 24.8055 28.9415C24.8307 28.9371 24.8559 28.9312 24.8812 28.9267L26.6936 31.5674C26.9667 31.966 27.4083 32.1797 27.8573 32.1797C28.1327 32.1797 28.4103 32.0996 28.6545 31.9318C29.2964 31.491 29.4597 30.6129 29.0196 29.971L27.507 27.7674C28.8912 26.7595 29.928 25.2477 30.2212 23.6186C30.2212 23.6149 30.2227 23.6119 30.2227 23.6082C30.5203 21.8529 30.6665 19.996 30.6687 17.9282C30.6665 15.8635 30.5203 14.0058 30.2227 12.2505C30.2227 12.2468 30.2212 12.2438 30.2212 12.2401ZM28.175 23.2556C27.9249 24.6317 26.842 25.9216 25.5187 26.5487C25.4014 26.5806 25.2871 26.6289 25.1788 26.6927C24.9428 26.7818 24.7008 26.8493 24.4559 26.8924C22.7815 27.1647 21.0018 27.2991 19.0164 27.3006C17.0288 27.2983 15.2491 27.1647 13.5747 26.8916C13.2993 26.8434 13.027 26.764 12.7627 26.6586C12.7004 26.6259 12.6358 26.5985 12.5713 26.5762C11.2205 25.9602 10.1094 24.6517 9.85559 23.2556C9.57801 21.6184 9.44219 19.8757 9.43996 17.9304C9.44219 15.9844 9.57801 14.2418 9.85559 12.6038C10.1703 10.8722 11.8023 9.2758 13.5754 8.96631C15.2491 8.69393 17.0288 8.56033 19.0142 8.55811C21.001 8.56033 22.7815 8.69393 24.4559 8.96631C26.2282 9.2758 27.8611 10.8722 28.175 12.6038C28.4526 14.2425 28.5884 15.9852 28.5906 17.9282C28.5884 19.875 28.4526 21.6176 28.175 23.2556Z" fill="white"/>
                    </g>
                    <defs>
                    <clipPath id="clip0_2240_69">
                    <rect width="38" height="38" fill="white"/>
                    </clipPath>
                    </defs>
                </svg>
            </div>
            <select
            onChange={handleEstacaoChange}
            value={estacaoSelecionada}
            disabled={!linhaSelecionada}
            className={`py-3 px-2 w-[80%] font-xxgeom text-[2.5vh] focus:outline-none ${
                estacaoSelecionada === ""
                ? 'text-white/40' 
                : 'text-white/100'
            }`}
            >
            <option value="" disabled>
                Escolha a estação
            </option>
            {estacoes
            .map((estacao) => (
                <option
                  key={estacao.sigla}
                  value={estacao.sigla}
                  disabled={estacao.sigla === siglaBloqueada}
                  className={estacao.sigla === siglaBloqueada ? 'text-white/40 bg-white' : 'text-black bg-white'}
                >
                  {estacao.nome}
                </option>
            ))}
            </select>
        </div>
    </div>
  );
};

export default SeletorDeEstacao;
